<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <title>Medalje-oversikt</title>
    <style>
        body { font-family: sans-serif; max-width: 400px; margin: 50px auto; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:disabled { background: #ccc; }
        #status { margin-top: 15px; font-size: 0.9em; color: #555; }
    </style>
</head>
<body>

    <h2>Oppdater Medaljer</h2>
    
    <div class="input-group">
        <label>Gull:</label>
        <input type="number" id="gull">
    </div>
    <div class="input-group">
        <label>Sølv:</label>
        <input type="number" id="solv">
    </div>
    <div class="input-group">
        <label>Bronse:</label>
        <input type="number" id="bronse">
    </div>

    <button id="saveBtn">Lagre til GitHub</button>
    <div id="status">Laster nåværende tall...</div>

    <script>
        // --- KONFIGURASJON ---
        const GIST_ID = '94059e011ad70a4a95e0be96a8da1c7d';
        const GITHUB_TOKEN = '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';
        const FILNAVN = 'medaljer.json'; // Navnet på filen inne i Gisten

        const gullInput = document.getElementById('gull');
        const solvInput = document.getElementById('solv');
        const bronseInput = document.getElementById('bronse');
        const saveBtn = document.getElementById('saveBtn');
        const statusDiv = document.getElementById('status');

        // 1. HENT DATA NÅR SIDEN ÅPNES
        async function fetchMedals() {
            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`);
                const data = await response.json();
                const content = JSON.parse(data.files[FILNAVN].content);
                
                gullInput.value = content.gull;
                solvInput.value = content.solv;
                bronseInput.value = content.bronse;
                statusDiv.innerText = "Data hentet fra GitHub.";
            } catch (err) {
                statusDiv.innerText = "Feil ved henting: " + err.message;
            }
        }

        // 2. OPPDATER DATA (PATCH)
        saveBtn.onclick = async () => {
            saveBtn.disabled = true;
            statusDiv.innerText = "Lagrer...";

            const nyttInnhold = {
                gull: parseInt(gullInput.value),
                solv: parseInt(solvInput.value),
                bronse: parseInt(bronseInput.value)
            };

            try {
                const response = await fetch(`https://api.github.com/gists/${GIST_ID}`, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `token ${GITHUB_TOKEN}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        files: {
                            [FILNAVN]: {
                                content: JSON.stringify(nyttInnhold, null, 2)
                            }
                        }
                    })
                });

                if (response.ok) {
                    statusDiv.innerText = "Suksess! Gisten er oppdatert.";
                } else {
                    statusDiv.innerText = "Kunne ikke lagre. Sjekk token/ID.";
                }
            } catch (err) {
                statusDiv.innerText = "Feil: " + err.message;
            } finally {
                saveBtn.disabled = false;
            }
        };

        fetchMedals();
    </script>
</body>
</html>